library(shiny)
library(ggplot2)

#Declaring Functions to be used Application
moving_average_calc <- function(data_input, n=2){
  ref = data_input
  n = n-1
  for(i in n:length(data_input)){
    ref[i] = mean(data_input[(i-n):i])
  }
  ref
}

#Embedded Data
date<-c('1/2/2015','1/5/2015','1/6/2015','1/7/2015','1/8/2015','1/9/2015','1/12/2015','1/13/2015','1/14/2015','1/15/2015','1/16/2015','1/20/2015','1/21/2015','1/22/2015','1/23/2015','1/26/2015','1/27/2015','1/28/2015','1/29/2015','1/30/2015','2/2/2015','2/3/2015','2/4/2015','2/5/2015','2/6/2015','2/9/2015','2/10/2015','2/11/2015','2/12/2015','2/13/2015','2/17/2015','2/18/2015','2/19/2015','2/20/2015','2/23/2015','2/24/2015','2/25/2015','2/26/2015','2/27/2015','3/2/2015','3/3/2015','3/4/2015','3/5/2015','3/6/2015','3/9/2015','3/10/2015','3/11/2015','3/12/2015','3/13/2015','3/16/2015','3/17/2015','3/18/2015','3/19/2015','3/20/2015','3/23/2015','3/24/2015','3/25/2015','3/26/2015','3/27/2015','3/30/2015','3/31/2015','4/1/2015','4/2/2015','4/6/2015','4/7/2015','4/8/2015','4/9/2015','4/10/2015','4/13/2015','4/14/2015','4/15/2015','4/16/2015','4/17/2015','4/20/2015','4/21/2015','4/22/2015','4/23/2015','4/24/2015','4/27/2015','4/28/2015','4/29/2015','4/30/2015','5/1/2015','5/4/2015','5/5/2015','5/6/2015','5/7/2015','5/8/2015','5/11/2015','5/12/2015','5/13/2015','5/14/2015','5/15/2015','5/18/2015','5/19/2015','5/20/2015','5/21/2015','5/22/2015','5/26/2015','5/27/2015','5/28/2015','5/29/2015','6/1/2015','6/2/2015','6/3/2015','6/4/2015','6/5/2015','6/8/2015','6/9/2015','6/10/2015','6/11/2015','6/12/2015','6/15/2015','6/16/2015','6/17/2015','6/18/2015','6/19/2015','6/22/2015','6/23/2015','6/24/2015','6/25/2015','6/26/2015','6/29/2015','6/30/2015','7/1/2015','7/2/2015','7/6/2015','7/7/2015','7/8/2015','7/9/2015','7/10/2015','7/13/2015','7/14/2015','7/15/2015','7/16/2015','7/17/2015','7/20/2015','7/21/2015','7/22/2015','7/23/2015','7/24/2015','7/27/2015','7/28/2015','7/29/2015','7/30/2015','7/31/2015','8/3/2015','8/4/2015','8/5/2015','8/6/2015','8/7/2015','8/10/2015','8/11/2015','8/12/2015','8/13/2015','8/14/2015','8/17/2015','8/18/2015','8/19/2015','8/20/2015','8/21/2015','8/24/2015','8/25/2015','8/26/2015','8/27/2015','8/28/2015','8/31/2015','9/1/2015','9/2/2015','9/3/2015','9/4/2015','9/8/2015','9/9/2015','9/10/2015','9/11/2015','9/14/2015','9/15/2015','9/16/2015','9/17/2015','9/18/2015','9/21/2015','9/22/2015','9/23/2015','9/24/2015','9/25/2015','9/28/2015','9/29/2015','9/30/2015','10/1/2015','10/2/2015','10/5/2015','10/6/2015','10/7/2015','10/8/2015','10/9/2015','10/12/2015','10/13/2015','10/14/2015','10/15/2015','10/16/2015','10/19/2015','10/20/2015','10/21/2015','10/22/2015','10/23/2015')
close<-c(2058.199951,2020.579956,2002.609985,2025.900024,2062.139893,2044.810059,2028.26001,2023.030029,2011.27002,1992.670044,2019.420044,2022.550049,2032.119995,2063.149902,2051.820068,2057.090088,2029.550049,2002.160034,2021.25,1994.98999,2020.849976,2050.030029,2041.51001,2062.52002,2055.469971,2046.73999,2068.590088,2068.530029,2088.47998,2096.98999,2100.340088,2099.679932,2097.449951,2110.300049,2109.659912,2115.47998,2113.860107,2110.73999,2104.5,2117.389893,2107.780029,2098.530029,2101.040039,2071.26001,2079.429932,2044.160034,2040.23999,2065.949951,2053.399902,2081.189941,2074.280029,2099.5,2089.27002,2108.100098,2104.419922,2091.5,2061.050049,2056.149902,2061.02002,2086.23999,2067.889893,2059.689941,2066.959961,2080.620117,2076.330078,2081.899902,2091.179932,2102.060059,2092.429932,2095.840088,2106.629883,2104.98999,2081.179932,2100.399902,2097.290039,2107.959961,2112.929932,2117.689941,2108.919922,2114.76001,2106.850098,2085.51001,2108.290039,2114.48999,2089.459961,2080.149902,2088,2116.100098,2105.330078,2099.120117,2098.47998,2121.100098,2122.72998,2129.199951,2127.830078,2125.850098,2130.820068,2126.060059,2104.199951,2123.47998,2120.790039,2107.389893,2111.72998,2109.600098,2114.070068,2095.840088,2092.830078,2079.280029,2080.149902,2105.199951,2108.860107,2094.110107,2084.429932,2096.290039,2100.439941,2121.23999,2109.98999,2122.850098,2124.199951,2108.580078,2102.310059,2101.610107,2057.639893,2063.110107,2077.419922,2076.780029,2068.76001,2081.340088,2046.680054,2051.310059,2076.620117,2099.600098,2108.949951,2107.399902,2124.290039,2126.639893,2128.280029,2119.209961,2114.149902,2102.149902,2079.649902,2067.639893,2093.25,2108.570068,2108.629883,2103.840088,2098.040039,2093.320068,2099.840088,2083.560059,2077.570068,2104.179932,2084.070068,2086.050049,2083.389893,2091.540039,2102.439941,2096.919922,2079.610107,2035.72998,1970.890015,1893.209961,1867.609985,1940.51001,1987.660034,1988.869995,1972.180054,1913.849976,1948.859985,1951.130005,1921.219971,1969.410034,1942.040039,1952.290039,1961.050049,1953.030029,1978.089966,1995.310059,1990.199951,1958.079956,1966.969971,1942.73999,1938.76001,1932.23999,1931.339966,1881.77002,1884.089966,1920.030029,1923.819946,1951.359985,1987.050049,1979.920044,1995.829956,2013.430054,2014.890015,2017.459961,2003.689941,1994.23999,2023.859985,2033.109985,2033.660034,2030.77002,2018.939941,2052.51001,2075.149902)
date <-as.Date(date,"%m/%d/%Y")
data <- data.frame(date,close)
plot <- ggplot(data) + geom_line(aes( x=date, y=close, colour='S&P 500')) + 
  xlab("Date") +
  ylab("USD$") +
  ggtitle("S&P 500 Jan-October 2015 Prices with Moving Average")

#Shiny Server
shinyServer( function(input, output) {
    
  MAvalue <- reactive({
    input$moving_avg
    })  
  
    output$plot <- renderPlot({
      avg_data <- moving_average_calc(data$close,input$moving_avg)
      avg<- data.frame(date,avg_data)
      plot <- plot + geom_line(data=avg, aes(x=date, y=avg_data, color='Moving Average')) +
        scale_colour_manual("", 
                           breaks = c("S&P 500", "Moving Average"),
                           values = c("blue", "black"))
      print(plot)
    })

})